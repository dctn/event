{% extends 'base.html' %}
{% load static %}

{% block head %}

{% endblock %}

{% block body %}

    <!-- nav bar -->



    <!-- event details -->
    <div class="event_details flex lg:items-center flex-col">
        <!-- event images -->
        <div class="event_imgs max-w-[1100px] mx-3 my-4 max-h-fit">
            <div
                    id="image"
                    data-carousel='{"loadingClasses": "opacity-0","isInfiniteLoop": true,"isAutoPlay": true, "speed": 3000 }'
                    class="relative w-full"
            >
                <div class="carousel">
                    <div class="carousel-body h-full opacity-0">
                        <!-- Slide 1 -->
                        <div class="carousel-slide">
                            <div class="flex h-full justify-center">
                                <img
                                        src="{{ event.img.url }}"
                                        class="size-full object-cover"
                                        alt="game"
                                />
                            </div>
                        </div>

                        {% if event.img_2 %}
                            <!-- Slide 2 -->
                            <div class="carousel-slide">
                                <div class="flex h-full justify-center">
                                    <img
                                            src="{{ event.img_2.url }}"
                                            class="size-full object-cover"
                                            alt="vrbox"
                                    />
                                </div>
                            </div>
                        {% endif %}

                        {% if event.img_3 %}
                            <!-- Slide 3 -->
                            <div class="carousel-slide">
                                <div class="flex h-full justify-center">
                                    <img
                                            src="{{ event.img_3.url }}"
                                            class="size-full object-cover"
                                            alt="laptop"
                                    />
                                </div>
                            </div>
                        {% endif %}

                        {% if event.img_4 %}
                            <!-- Slide 4 -->
                            <div class="carousel-slide">
                                <div class="flex h-full justify-center">
                                    <img
                                            src="{{ event.img_4.url }}"
                                            class="size-full object-cover"
                                            alt="VRBox"
                                    />
                                </div>
                            </div>
                        {% endif %}

                        {#            #}
                        {#              <!-- Slide 5 -->#}
                        {#              <div class="carousel-slide">#}
                        {#                <div class="flex h-full justify-center">#}
                        {#                  <img#}
                        {#                    src="https://cdn.flyonui.com/fy-assets/components/carousel/image-23.png"#}
                        {#                    class="size-full object-cover"#}
                        {#                    alt="iwatch"#}
                        {#                  />#}
                        {#                </div>#}
                        {#              </div>#}
                        {#            </div>#}
                        {#          </div>#}
                        <!-- Previous Slide -->
                        <button
                                type="button"
                                class="carousel-prev start-5 max-sm:start-3 carousel-disabled:opacity-50 size-9.5 bg-base-100 flex items-center justify-center rounded-full shadow-base-300/20 shadow-sm"
                        >
            <span
                    class="icon-[tabler--chevron-left] size-5 cursor-pointer"
            ></span>
                            <span class="sr-only">Previous</span>
                        </button>
                        <!-- Next Slide -->
                        <button
                                type="button"
                                class="carousel-next end-5 max-sm:end-3 carousel-disabled:opacity-50 size-9.5 bg-base-100 flex items-center justify-center rounded-full shadow-base-300/20 shadow-sm"
                        >
                            <span class="icon-[tabler--chevron-right] size-5"></span>
                            <span class="sr-only">Next</span>
                        </button>
                    </div>
                </div>

                <!-- event details -->
                <div
                        class="event_content p-6 flex flex-col items-center gap-8 justify-center max-w-[1200px]"
                >

                    <div class="details flex flex-col md:flex-row gap-5">

                        <div class="w-full flex flex-col gap-3">
                            <h1 class="text-5xl font-mono capitalize text-black font-bold">
                                {{ event.name }}
                            </h1>


                            <div class="main_details">
                                <h5 class="text-gray-800 text-xl mb-2">
                                    <img src="{% static 'icons/clock-svgrepo-com.svg' %}" class="icon_size" alt="">
                                    {{ event.location }}
                                </h5>

                                <h5 class="text-gray-800 text-xl mb-2">
                                    <img src="{% static 'icons/location-svgrepo-com.svg' %}" class="icon_size" alt="">
                                    {{ event.registion_on_date }},<span>{{ event.event_starting_time }}</span>
                                </h5>

                                <h5 class="text-gray-800 text-xl mb-2">
                                    {% if event.event_type == "free" %}
                                        Entry: <span class="font-bold text-green-500 ">Free</span>
                                    {% else %}
                                        Entry: <span class="font-bold text-green-500 ">Paid</span>

                                    {% endif %}
                                </h5>
                            </div>

                        </div>

                        <div class="md:w-3/5 ticket_price w-full">
                            <div class="card sm:max-w-sm shadow-2xl">
                                <div class="card-body">

                                    <a class="btn btn_primary_color "
                                       download href="{% url 'download_img' event.event_id %}"> download poster
                                    </a>

                                    {% if event.event_type == "paid" %}
                                        <h5 class="card-title mb-2.5 capitalize text-2xl">ticket:</h5>
                                        <p class="mb-4 font-mono">Price per ticket: {{ event.amount }}</p>
                                        <div class="card-actions">
                                        {% if is_already_registered %}
                                            <p class="mb-4 font-mono">You already register this event</p>
                                        {% else %}
                                            <button id="openCheckoutModal"
                                                    class="btn btn-primary px-4 py-2 rounded bg-purple-600 text-white">
                                                Register
                                            </button>

                                        {% endif %}

                                    {% elif event.current_slots == 0 %}
                                        <p class="mb-4 font-mono">All seats are fulled</p>
                                    {% elif not event.is_booking_close %}
                                        <p class="mb-4 font-mono">Booking Date is closed</p>

                                    {% else %}
                                        <h5 class="card-title mb-2.5 capitalize text-2xl">ticket:</h5>
                                        <p class="mb-4 font-mono">Price per ticket: Free</p>
                                        <div class="card-actions">
                                        {% if is_already_registered %}
                                            <p class="mb-4 font-mono">You already register this event</p>
                                            <a class="btn btn_primary_color "
                                               href="{% url 'register_free_event' event.event_id 'un_register' %}">UnRegister
                                            </a>
                                        {% else %}
                                            <a class="btn btn_primary_color "
                                               href="{% url 'register_free_event' event.event_id 'register' %}">Register
                                            </a>
                                        {% endif %}

                                    {% endif %}

                                    {% if is_owner %}
                                        <a href="{% url 'event_update' event.event_id %}"
                                           class="btn btn-primary">Update</a>
                                         <a href="{% url 'create_game' event.event_id %}"
                                           class="btn btn-primary">Create Game</a>
                                        <a href="{% url 'qr_scan' event.event_id %}" class="btn btn-gradient">Qr
                                            code</a>

                                    {% endif %}

                                 <a class="btn btn_primary_color "
                                        href="{% url 'game_list' event.event_id %}"> View games
                                    </a>
                                    </div>


                                    <!-- Modal Overlay -->
                                    <div id="checkoutModal"
                                         class="fixed inset-0 bg-black/70 flex items-center justify-center hidden z-50">
                                        <!-- Modal Content -->
                                        <div class="bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative">
                                            <!-- Close Button -->
                                            <button id="closeCheckoutModal"
                                                    class="absolute top-99 right-9 text-gray-700 hover:text-gray-900 text-2xl font-bold m-2">
                                                &times;
                                            </button>
                                            <!-- Modal Title -->
                                            <h2 class="text-lg font-bold mb-4">Checkout Details</h2>
                                            <!-- Checkout Details -->
                                            <div>
                                                <p><strong>Product Amount:</strong> ₹{{ event.amount }}</p>
                                                <p><strong>Platform Fee (10%):</strong> ₹{{ platform }}</p>
                                                <p><strong>Razorpay Fee (3% + GST):</strong> ₹{{ razorpay_fee_rate }}
                                                </p>
                                                <hr class="my-4">
                                                <p class="text-lg font-semibold">Total Amount to Pay:
                                                    ₹{{ total_charge }}</p>
                                            </div>
                                            <!-- Confirm Payment Button -->
                                            <div class="mt-6 text-right">
                                                <button class="btn btn_primary_color " id="rzp-button1">
                                                    Checkout
                                                </button>
                                            </div>
                                        </div>
                                    </div>


                                    </div>
                                </div>
                            </div>

                        </div>


                        <div class="event_desp m-3 my-3">
                            <h2 class="text-4xl capitalize text-black font-semibold">
                                Event description
                            </h2>

                            <p class="text-2xl mb-3">
                                {{ event.event_details|linebreaksbr }}
                            </p>

                            <h2 class="text-4xl capitalize text-black font-semibold">
                                Event Organized by: <br/>
                                <span class="ml-10 font-normal font-mono capitalize bg-warning text-warning-content font-extrabold p-1">{{ event.club_name }}</span>
                            </h2>
                        </div>

                        <div class="vol_table w-full overflow-x-auto">
                            <h2 class="text-2xl capitalize text-black font-semibold">
                                volunteers and organizers details:
                            </h2>
                            <div class="w-full overflow-x-auto card show">
                                <table class="table overflow-x-auto table-lg">
                                    <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Position</th>
                                        <!-- <th>Status</th> -->
                                        <th>Phone No</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr class="row-hover">
                                        <td>{{ event.volunteer_name }}</td>
                                        <td>{{ event.volunteer_position }}</td>
                                        <!-- <td><span class="badge badge-soft badge-success text-xs">Professional</span></td> -->
                                        <td>{{ event.volunteer_phone_no }}</td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>

                <script src="https://checkout.razorpay.com/v1/checkout.js"></script>


                <script>
                    document.getElementById("rzp-button1").addEventListener("click", async function (e) {
                        e.preventDefault();

                        let response = await fetch("{% url 'proccess_order' event.event_id %}", {
                            method: "POST",
                            headers: {
                                "X-CSRFToken": "{{ csrf_token }}", // Only if CSRF is required
                                "Content-Type": "application/json"
                            }
                        });

                        let data = await response.json();

                        var options = {
                            "key": data.RAZORPAY_KEY_ID,
                            "amount": data.amount,
                            "currency": "INR",
                            "name": "Campify",
                            "description": "Transaction",
                            "image": "https://example.com/your_logo",
                            "order_id": data.order_id,
                            "callback_url": data.callback_url,
                            "notes": {
                                "address": "Campify Events"
                            },
                            "theme": {
                                "color": "#3399cc"
                            }
                        };

                        var rzp1 = new Razorpay(options);

                        rzp1.on('payment.failed', function (response) {
                            alert("Payment failed: " + response.error.description);
                        });

                        rzp1.open();
                    });
                </script>

                <script>
                    const openBtn = document.getElementById('openCheckoutModal');
                    const closeBtn = document.getElementById('closeCheckoutModal');
                    const modal = document.getElementById('checkoutModal');

                    openBtn.addEventListener('click', () => {
                        modal.classList.remove('hidden');
                    });

                    closeBtn.addEventListener('click', () => {
                        modal.classList.add('hidden');
                    });

                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.classList.add('hidden');
                        }
                    });
                </script>

{% endblock %}